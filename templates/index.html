<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mirror Loop</title>
<style>
:root{ --panel: rgba(18,26,44,.6); --ink:#eaf7ff; --muted:#9db5c9; --accent:#00b7ff; }
html,body{height:100%;margin:0;font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,sans-serif;color:var(--ink);}
body{display:flex;flex-direction:column;align-items:center;padding:40px;background:radial-gradient(1000px 1000px at 50% 52%,#0b1d3a,#040a16 60%,#02060f 100%);animation:breatheBg 9s ease-in-out infinite alternate;}
@keyframes breatheBg{0%{background:radial-gradient(1000px 1000px at 50% 52%,#0b1d3a,#040a16 60%,#02060f 100%);}100%{background:radial-gradient(1100px 1100px at 50% 52%,#0e244b,#061126 60%,#02060f 100%);}}

/* ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ */
.catch{text-align:center;color:#eaf2ff;margin-bottom:30px;max-width:700px;}
.catch h1{font-size:1.6rem;background:linear-gradient(90deg,#8fd3f4,#84fab0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.catch p{font-size:1.1rem;color:#b8c8e6;}

/* ã‚«ãƒ¼ãƒ‰ */
.card{width:min(94vw,440px);background:var(--panel);backdrop-filter:blur(18px);border-radius:20px;padding:22px;margin-bottom:20px;box-shadow:0 20px 60px rgba(0,0,0,.35);}
h1{margin:0 0 10px;font-size:1.05rem;color:#8dd4ff;text-align:center;}
.row{display:flex;gap:8px;}
input{width:100%;padding:12px 14px;border-radius:12px;border:none;background:rgba(255,255,255,.08);color:var(--ink);}
.btn{border:none;cursor:pointer;color:white;border-radius:12px;padding:12px 14px;font-weight:700;flex:1;background:linear-gradient(90deg,#0a84ff,#00b7ff);transition:box-shadow .25s,transform .05s;}
.btn:hover{box-shadow:0 0 22px rgba(0,183,255,.45);}
.btn:active{transform:translateY(1px);}
.result{margin-top:12px;background:rgba(255,255,255,.05);border-radius:12px;padding:12px;min-height:110px;}
.footer{text-align:center;margin-top:8px;font-size:.8rem;color:#86a3b8;}

/* æ—¥è¨˜ãƒ¢ãƒ¼ãƒ‰ */
#diaryList{margin-top:20px;width:min(94vw,440px);background:rgba(255,255,255,.05);border-radius:12px;padding:16px;}
#diaryList h2{margin-top:0;font-size:1.1rem;color:#9cc8ff;}
.entry{background:rgba(255,255,255,.06);margin-bottom:10px;border-radius:8px;padding:8px 12px;}
.entry-date{color:#a9bcd4;font-size:.85rem;}
.entry-text{white-space:pre-wrap;margin-top:4px;}
.summaryBox{background:rgba(255,255,255,.08);padding:10px;border-radius:10px;margin-top:12px;font-size:.95rem;}
</style>
</head>
<body>
<div class="catch">
  <h1>ãƒ¢ãƒ¤ã£ã¨ã—ãŸã¾ã¾ã§å¿ƒãŒãã¡ã‚ƒãã¡ã‚ƒã ã¨å‰ã«é€²ã‚ãªã„ã€‚</h1>
  <p>AIã«å¿ƒã®ä¸­ã‚’æ•´ç†ã—ã¦ã‚‚ã‚‰ã„ã€ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã¯ã€Œå¿ƒã‚’æ˜ ã™AIæ—¥è¨˜ã‚¢ãƒ—ãƒªã€ã§ã™ã€‚</p>
</div>

<div class="card">
  <h1>ğŸ’ Mirror Loop</h1>
  <input id="userInput" placeholder="ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚„æ°—æŒã¡ã‚’å…¥åŠ›â€¦" autocomplete="off"/>
  <div class="row" style="margin-top:10px;">
    <button id="reflectBtn" class="btn">Reflect</button>
    <button id="summarizeBtn" class="btn" style="background:linear-gradient(90deg,#24c6dc,#514a9d)">ä»Šæ—¥ã®ã¾ã¨ã‚</button>
  </div>
  <div id="result" class="result"></div>
  <div class="footer">Reflectã—ãŸå†…å®¹ã¯è‡ªå‹•ã§ä¿å­˜ã•ã‚Œã€ã„ã¤ã§ã‚‚æ—¥è¨˜ã‹ã‚‰è¦‹è¿”ã›ã¾ã™ã€‚</div>
</div>

<div id="diaryList">
  <h2>ğŸ“˜ æ—¥è¨˜ä¸€è¦§</h2>
  <div id="entries"></div>
</div>

<script>
const reflectBtn = document.getElementById("reflectBtn");
const summarizeBtn = document.getElementById("summarizeBtn");
const input = document.getElementById("userInput");
const result = document.getElementById("result");
const entries = document.getElementById("entries");

function today(){return new Date().toISOString().slice(0,10);}
function loadDiary(){return JSON.parse(localStorage.getItem("mirror_diary")||"{}");}
function saveDiary(d){localStorage.setItem("mirror_diary",JSON.stringify(d));}
function renderDiary(){
  const data=loadDiary();
  entries.innerHTML="";
  Object.keys(data).sort().reverse().forEach(date=>{
    const div=document.createElement("div");
    div.className="entry";
    div.innerHTML=`<div class="entry-date">${date}</div><div class="entry-text">${data[date].join("\\n")}</div>`;
    entries.appendChild(div);
  });
}

reflectBtn.onclick=async()=>{
  const text=input.value.trim(); if(!text) return alert("å…¥åŠ›ã—ã¦ãã ã•ã„");
  result.textContent="è€ƒãˆã¦ã„ã¾ã™â€¦";
  const r=await fetch("/reflect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_input:text})});
  const data=await r.json();
  if(!data.reply){result.textContent="ã‚¨ãƒ©ãƒ¼";return;}
  const {summary,advice,next}=data.reply;
  const msg=`${summary}\\n${advice}\\n${next}`;
  result.textContent=msg;
  const diary=loadDiary(); const date=today();
  diary[date]=diary[date]||[]; diary[date].push(msg); saveDiary(diary);
  renderDiary(); input.value="";
};

summarizeBtn.onclick=async()=>{
  const diary=loadDiary(); const date=today(); const items=diary[date]||[];
  if(items.length===0) return alert("ä»Šæ—¥ã®ReflectãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚");
  result.textContent="AIãŒã¾ã¨ã‚ã¦ã„ã¾ã™â€¦";
  const r=await fetch("/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items})});
  const data=await r.json();
  if(data.summary){
    const box=document.createElement("div");
    box.className="summaryBox";
    box.textContent="ğŸ§  ä»Šæ—¥ã®ã¾ã¨ã‚ï¼š"+data.summary;
    result.appendChild(box);
  }
};

renderDiary();
</script>
</body>
</html>
