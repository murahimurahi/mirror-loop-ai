<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mirror Loop v0.3.6</title>
<style>
:root{
  --bg1:#0f172a;--bg2:#111827;--fg:#e5e7eb;--muted:#94a3b8;
  --accent:#22d3ee;--accent2:#60a5fa;--card:#0b1220;
  --ok:#34d399;--warn:#f59e0b;
}
[data-theme="light"]{
  --bg1:#f8fafc;--bg2:#eef2ff;--fg:#0f172a;--muted:#475569;
  --accent:#0284c7;--accent2:#7c3aed;--card:#ffffff;
  --ok:#059669;--warn:#b45309;
}

/* ===== èƒŒæ™¯ï¼ˆçœŸã‚“ä¸­ã‹ã‚‰å††çŠ¶ã«â€œå‘¼å¸æ³¢ç´‹â€ï¼‰ ===== */
body{
  margin:0;min-height:100dvh;color:var(--fg);
  background: radial-gradient(circle at center,
    rgba(96,165,250,0.18) 0%,
    rgba(34,211,238,0.1) 25%,
    rgba(124,58,237,0.08) 50%,
    transparent 70%
  ),linear-gradient(135deg,var(--bg1),var(--bg2));
  background-repeat:no-repeat;
  background-size:200% 200%;
  animation: breathe 12s ease-in-out infinite, shift 60s linear infinite;
  overflow-x:hidden;
}
@keyframes breathe{
  0%,100%{background-size:160% 160%;}
  50%{background-size:200% 200%;}
}
@keyframes shift{
  0%{background-position:center 60%,0 0;}
  50%{background-position:center 40%,100% 100%;}
  100%{background-position:center 60%,0 0;}
}

.wrap{max-width:980px;margin:0 auto;padding:28px;}
.card{
  background:color-mix(in oklab,var(--card)88%,transparent);
  border:1px solid color-mix(in oklab,var(--fg)10%,transparent);
  backdrop-filter:blur(6px);border-radius:18px;padding:22px;
  box-shadow:0 20px 60px rgba(0,0,0,.28);
}
h1{font-size:clamp(22px,2.6vw,28px);margin:4px 0 16px;}
.sub{color:var(--muted);font-size:14px;margin-bottom:18px}

/* ===== ãƒœã‚¿ãƒ³ï¼‹Ripple ===== */
.btn{
  position:relative;overflow:hidden;cursor:pointer;user-select:none;
  color:#0b1220;font-weight:700;padding:12px 16px;border:none;
  border-radius:12px;min-width:116px;
  background:linear-gradient(180deg,var(--accent),var(--accent2));
  box-shadow:0 10px 28px color-mix(in oklab,var(--accent)35%,transparent);
  transition:transform .06s ease,filter .2s ease,box-shadow .2s ease;
}
.btn:hover{filter:brightness(1.05);}
.btn:active{transform:translateY(1px)scale(.98);}
.ripple{
  position:absolute;border-radius:50%;pointer-events:none;
  transform:translate(-50%,-50%);width:20px;height:20px;
  background:rgba(255,255,255,.6);mix-blend-mode:screen;
  animation:ripple 0.8s ease-out forwards;
}
@keyframes ripple{
  0%{opacity:.4;transform:translate(-50%,-50%)scale(0);}
  70%{opacity:.2;}
  100%{opacity:0;transform:translate(-50%,-50%)scale(12);}
}
.btn.secondary{
  color:var(--fg);
  background:linear-gradient(180deg,color-mix(in oklab,var(--fg)10%,transparent),color-mix(in oklab,var(--fg)18%,transparent));
  box-shadow:none;border:1px solid color-mix(in oklab,var(--fg)14%,transparent);
}

/* ãã®ä»–UIï¼ˆç•¥ï¼‰ */
textarea{width:100%;min-height:72px;color:var(--fg);background:transparent;
  border:1px solid color-mix(in oklab,var(--fg)12%,transparent);
  border-radius:14px;padding:14px;resize:vertical;outline:none;}
textarea:focus{
  border-color:color-mix(in oklab,var(--accent)70%,var(--fg)30%);
  box-shadow:0 0 0 3px color-mix(in oklab,var(--accent)22%,transparent);
}
.log{margin-top:14px;padding:14px;border-radius:12px;
  background:color-mix(in oklab,var(--card)88%,transparent);
  border:1px solid color-mix(in oklab,var(--fg)10%,transparent);
  max-height:52dvh;overflow:auto;white-space:pre-wrap;}
.kpi{color:var(--muted);font-size:13px;margin:10px 0 2px;}
.bar{height:10px;width:100%;background:color-mix(in oklab,var(--fg)10%,transparent);
  border-radius:999px;overflow:hidden}
.bar>i{display:block;height:100%;width:18%;background:linear-gradient(90deg,var(--ok),var(--accent));}
.hint{color:var(--muted);font-size:12px;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ğŸ’ Mirror Loop v0.3.6</h1>
    <div class="sub">ä¸­å¿ƒã‹ã‚‰æ³¢ç´‹ãŒã‚†ã£ãã‚ŠåºƒãŒã‚‹â€œå‘¼å¸æ„Ÿâ€æ¼”å‡ºä»˜ãã€‚</div>
    <textarea id="userInput" placeholder="Reflectã‚’å…¥åŠ›..."></textarea>
    <div class="hint">Enterã§é€ä¿¡ã€‚é€ä¿¡å¾Œã¯å…¥åŠ›æ¬„ãŒè‡ªå‹•ã‚¯ãƒªã‚¢ã€‚</div>
    <div style="margin-top:12px;display:flex;gap:10px;">
      <button id="reflectBtn" class="btn">Reflect</button>
      <button id="weeklyBtn" class="btn secondary">é€±å ±ã‚’ä½œæˆ</button>
    </div>
    <div class="kpi">æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆéå»7æ—¥ï¼‰</div>
    <div class="bar"><i id="scoreFill"></i></div>
    <div id="log" class="log">ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
  </div>
</div>

<script>
// rippleï¼ˆæ³¢ç´‹ã‚¯ãƒªãƒƒã‚¯ï¼‰
function attachRipple(el){
  el.addEventListener('click', ev=>{
    const old = el.querySelector('.ripple'); if(old) old.remove();
    const span=document.createElement('span');
    span.className='ripple';
    const rect=el.getBoundingClientRect();
    span.style.left=(ev.clientX-rect.left)+'px';
    span.style.top=(ev.clientY-rect.top)+'px';
    el.appendChild(span);
    span.addEventListener('animationend',()=>span.remove());
  });
}
document.querySelectorAll('.btn').forEach(attachRipple);

// å…¥åŠ›é€ä¿¡ï¼ˆç•¥ï¼šå‹•ä½œç¶­æŒï¼‰
const input=document.getElementById('userInput');
const log=document.getElementById('log');
const scoreFill=document.getElementById('scoreFill');
const reflectBtn=document.getElementById('reflectBtn');
const weeklyBtn=document.getElementById('weeklyBtn');

const postJSON=async(u,b)=>{const r=await fetch(u,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(b)});if(!r.ok)throw new Error(await r.text());return r.json();};

async function doReflect(){
  const t=input.value.trim();if(!t)return input.focus();
  reflectBtn.disabled=true;
  try{
    const d=await postJSON('/reflect',{user_input:t});
    log.textContent=`ã€ä»Šæ—¥ã®è¦ç´„ã€‘${d.result||''}\nã€ã‚¹ã‚³ã‚¢ã€‘${d.score||'-'}`;
    scoreFill.style.width=Math.min(100,Math.max(0,Number(d.score)||0))+'%';
    input.value='';
  }catch(e){log.textContent='âš ï¸ '+e.message;}
  finally{reflectBtn.disabled=false;}
}
reflectBtn.onclick=doReflect;
</script>
</body>
</html>
